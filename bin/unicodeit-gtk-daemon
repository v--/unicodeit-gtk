#!/usr/bin/env python3

from threading import Thread
import subprocess
import sys

from unicodeit_gtk import UnicodeItApp, UnicodeItContent, UnicodeItExitCodeError


def wtype(value: str):
    if value:
        subprocess.run(['wtype', value])


def on_submit(widget: UnicodeItContent, value: str, app: UnicodeItApp):
    if app.window:
        app.window.set_visible(False)

    thread = Thread(target=wtype, args=[value])
    thread.start()


if __name__ ==  '__main__':
    try:
        app = UnicodeItApp(hide_window=True)
        app.content.connect('submit', on_submit, app)
        app.run(sys.argv)
    except UnicodeItExitCodeError as err:
        sys.exit(err.code)
